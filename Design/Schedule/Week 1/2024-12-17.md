# 12월 17일 수요일 (Day 2)

## 저장/로드 시스템 점검 및 보완

### 현재 구현 상태
**이미 구현된 기능:**
- [x] GameDataManager 기본 저장/로드 시스템
  - [x] 비동기 저장 지원 (USE_ASYNC_SAVE = true)
  - [x] 저장 쿨다운 시스템 (SAVE_COOLDOWN_TIME = 1.0f)
  - [x] 백업 저장 시스템 (3회마다 자동 백업)
  - [x] 암호화 지원 (AES)
  - [x] 복구 시스템 (LoadGameDataWithRecovery)
  - [x] 데이터 마이그레이션 시스템
- [x] 씬 전환 시 저장 로직
  - [x] GameMainScene.CleanupCurrentScene()에서 SaveGameData() 호출
  - [x] 씬 전환 전 자동 저장 구현됨
- [x] GameApp.Update()에서 ProcessPendingSave() 호출
  - [x] 대기 중인 저장 처리 시스템

**현재 저장되는 데이터 구조 (VProfile):**
- [x] VCharacterLevel (레벨 및 경험치 데이터)
- [x] VCharacterEnhancement (강화 능력치 레벨 데이터)
- [x] VCharacterGrowth (성장 능력치 레벨 및 능력치 포인트 데이터)
- [x] VCharacterWeapon (무기 데이터)
- [x] VCharacterPotion (물약 데이터)
- [x] VCharacterItem (아이템 데이터)
- [x] VCurrency (재화 데이터)
- [x] VCharacterStage (스테이지 데이터)
- [x] VCharacterSlot (슬롯 데이터)
- [x] VStatistics (통계 데이터)

### 추가 구현 필요 사항
- [ ] 주기적 자동 저장 구현
  - [ ] 저장 주기 설정 (예: 30초마다)
  - [ ] 저장 트리거 관리
  - [ ] 저장 실패 시 재시도 로직
- [ ] 게임 종료 시 저장 로직
  - [ ] OnApplicationPause 처리 (GameApp에 추가)
  - [ ] OnApplicationFocus 처리 (GameApp에 추가)
  - [ ] 강제 종료 대응 (가능한 범위 내)

### 세이브 파일 관리 테스트
- [ ] 세이브 파일 관리 테스트
  - [ ] 세이브 파일 생성/삭제 테스트
  - [ ] 세이브 파일 로드 검증 테스트
  - [ ] 세이브 파일 백업/복구 테스트
  - [ ] 데이터 마이그레이션 테스트
  - [ ] 저장 실패 시나리오 테스트

### 데이터 저장 항목 확장 (향후 추가될 데이터)
- [ ] 게임 데이터 저장 구조 확장
  - [ ] 퀘스트 진행도 데이터 (향후 추가)
  - [ ] 출석보상 데이터 (향후 추가)
  - [ ] 스킬 데이터 (향후 추가)
  - [ ] 장비 데이터 (향후 추가)

### 데이터 구조 재설계 (현재 게임에 맞게)
- [x] VCharacter 구조 단순화
  - [x] 다중 캐릭터 관리 로직 제거 (VCharacter 클래스 삭제)
  - [x] 단일 플레이어 데이터 구조로 변경
  - [ ] 스킬 슬롯 해금 상태 필드 추가 (향후 추가)
- [x] VCharacterStat 분리
  - [x] VCharacterEnhancement 클래스 구현
    - [x] 골드로 구매하는 강화 능력치 필드 (Dictionary<string, int>로 레벨 저장)
    - [ ] 성장 지식 필드 (괴력, 강철의 육체, 강인한 심장, 초인의 힘) (향후 추가)
  - [x] VCharacterGrowth 클래스 구현
    - [x] SP(능력치 포인트) 필드
    - [x] SP로 구매하는 능력치 필드 (Dictionary<string, int>로 레벨 저장)
    - [x] CharacterGrowthTypes 기반 오버로드 메서드 추가
      - [x] GetLevel(CharacterGrowthTypes) 메서드 추가
      - [x] SetLevel(CharacterGrowthTypes, int) 메서드 추가
      - [x] AddLevel(CharacterGrowthTypes, int) 메서드 추가
      - [x] GrowthTypeToStatName() 변환 메서드 추가
- [x] ScriptableObject 데이터 구조 구현
  - [x] EnhancementDataAsset: 강화 시스템 데이터 구조 구현
  - [x] GrowthDataAsset: 성장 시스템 데이터 구조 구현
    - [x] CharacterGrowthTypes 기반 검색 메서드 추가
      - [x] FindGrowthDataByType(CharacterGrowthTypes) 메서드 추가
      - [x] GetStatNameByGrowthType() 변환 메서드 추가
      - [x] GetGrowthTypeByStatName() 변환 메서드 추가
    - [x] CreateAllStatData에서 GrowthType 자동 설정
    - [x] LogErrorInvalid에 GrowthType 유효성 검사 및 중복 체크 추가
  - [x] ExperienceConfigAsset: 경험치 설정 데이터 구조 구현
  - [x] ScriptableDataManager 통합
  - [x] Editor 자동 생성 스크립트 (CharacterSystemAssetCreator)
- [ ] VCompanion 시스템 구현
  - [ ] VCompanion 기본 클래스 구현
  - [ ] VCompanionInfo 클래스 구현
    - [ ] 동료 해금 상태 저장
    - [ ] 동료 레벨 저장 (플레이어와 별개)
    - [ ] 강화패시브 레벨 저장 (3개 카테고리)
    - [ ] 전직 정보 저장 (1~7차)
    - [ ] 승급 옵션 저장 (전직별)
  - [ ] VCompanionPromotionOption 클래스 구현
  - [ ] VProfile에 VCompanion 추가
- [ ] 신규 데이터 클래스 구현
  - [ ] VCharacterAccessory 클래스 구현 (악세사리 데이터)
  - [ ] VRelic 클래스 구현 (유물 데이터)
  - [ ] VSpirit 클래스 구현 (정령 데이터)
- [x] VProfile 업데이트
  - [x] VCharacterEnhancement 추가
  - [x] VCharacterGrowth 추가
  - [x] VCharacterStat 제거
  - [x] VCharacter 제거
  - [ ] VCompanion 추가 (향후 추가)
  - [ ] VCharacterAccessory 추가 (향후 추가)
  - [ ] VRelic 추가 (향후 추가)
  - [ ] VSpirit 추가 (향후 추가)
  - [ ] VCharacterPotion 제거 (향후 제거)
  - [ ] VCharacterItem 제거 (향후 제거)
  - [ ] VCharacterSlot 제거 (향후 제거)
- [ ] 데이터 마이그레이션 코드 작성
  - [ ] 기존 VCharacter 데이터를 새 구조로 변환
  - [ ] 기존 VCharacterStat 데이터를 VCharacterEnhancement와 VCharacterGrowth로 분리
  - [ ] 마이그레이션 테스트
- [ ] 데이터 구조 설계 문서 작성
  - [x] DATA_STRUCTURE_DESIGN.md 작성 완료

---

## 전투 시스템 리팩토링

### DamageTypes 정리
- [x] 사용하지 않는 피해 타입 삭제
  - [x] Grab (잡기) 삭제
  - [x] Overwhelm (압도) 삭제
  - [x] Sacrifice (희생) 삭제
  - [x] Spawn 삭제
  - [x] Physical → Normal로 통합

### 마나/보호막 회복 시스템 구현
- [x] 마나 회복 시스템 추가
  - [x] DamageTypes에 RestoreMana, RestoreManaOverTime 추가
  - [x] IsRestoreMana() 확장 메서드 추가
  - [x] Vital.RestoreMana() 메서드 추가
  - [x] DamageCalculator.ComputeRestoreManaValue() 메서드 추가
  - [x] AttackEntity.ProcessRestoreManaDamage() 메서드 추가
  - [x] BuffEntity.Apply에 마나 회복 처리 로직 추가
  - [x] UIFloatyText에 마나 회복 플로팅 텍스트 지원 추가
- [x] 보호막 충전 시스템 복구
  - [x] DamageTypes에 Charge 추가
  - [x] IsCharge() 확장 메서드 추가
  - [x] Vital.Charge() 메서드 추가
  - [x] Vital.RefreshShieldGauge() 메서드 추가
  - [x] Vital.Field에 Shield 필드 추가
  - [x] DamageCalculator.ComputeChargeValue() 메서드 추가
  - [x] AttackEntity.ProcessChargeDamage() 메서드 추가
  - [x] BuffEntity.Apply에 보호막 충전 처리 로직 추가
  - [x] UIFloatyText에 보호막 충전 플로팅 텍스트 지원 추가
  - [x] Shield.SpawnShieldFloatyText()에서 Collider 의존성 제거

### Vital 시스템 정리
- [x] Collider/Guard 기능 제거
  - [x] Vital.Guard.cs 파일 삭제
  - [x] Collider, Colliders, GuardColliderIndexes 필드 제거
  - [x] GetNotGuardCollider, CheckGuardCollider, SetGuardActive 등 메서드 제거
  - [x] GuardFeedbacks 필드 제거
  - [x] Life.Invulnerable에서 ActivateColliders/DeactivateColliders 호출 제거

### DamageCalculator 코드 정리
- [x] Physical 네이밍 정리
  - [x] HandleComputePhysical → HandleComputeDamage
  - [x] HandleComputePhysicalOverTime → HandleComputeDamageOverTime
  - [x] ComputePhysicalDamage → ComputeDamage
  - [x] ComputePhysicalDamageOverTime → ComputeDamageOverTime
  - [x] CalculatePhysicalDamageMultiplier → CalculateDamageMultiplier
  - [x] CalculatePhysicalDamageReduction → CalculateDamageReduction
  - [x] 지역 변수명 정리 (physicalDamage → baseDamage, totalPhysicalDamage → totalDamage)
- [x] 주석/로그 실제 기능과 일치하도록 수정
  - [x] "물리 또는 마법 피해량 배율" → "피해량 배율"
  - [x] 가시 피해 계산 주석에서 "추가 피해" 부분 제거

### 기타 정리
- [x] HitmarkAssetData에서 IsRequireShieldForOverwhelm 필드 삭제
- [x] UIFloatyMoveNames에서 Overwhelm 항목 삭제
- [x] UIFloatyText에서 OverwhelmSprite 필드 및 관련 로직 삭제

---

## 캐릭터 게이지 시스템 리팩토링

### 게이지 UI 구조 개선
- [x] ICharacterGaugeView 인터페이스 통합
  - [x] IEnemyGaugeView → ICharacterGaugeView로 이름 변경
  - [x] 플레이어/몬스터 게이지 공통 인터페이스로 통합
- [x] UIGaugeManager 메서드 이름 변경
  - [x] EnemyGauges → CharacterGauges
  - [x] FindEnemy() → FindCharacter()
  - [x] RegisterEnemy() → RegisterCharacter()
  - [x] UnregisterEnemy() → UnregisterCharacter()
  - [x] SpawnPlayerGauge() 메서드 추가

### UIEnemyGauge 수정
- [x] MonsterCharacter → Character로 변경 (플레이어도 사용 가능)
- [x] 보호막/마나 게이지 삭제
- [x] 쿨타임 게이지 추가
  - [x] ShowCooldown() 메서드 추가 (게이지 활성화 및 0으로 초기화)
  - [x] HideCooldown() 메서드 추가 (게이지 비활성화)
  - [x] SetCooldown(float rate) 메서드 추가 (진행도 설정)
- [x] VitalResource.Rate 프로퍼티 활용하도록 개선

### UIPlayerGauge 구현
- [x] UIPlayerGauge 클래스 생성
- [x] 체력/보호막/마나 게이지 지원
- [x] VitalResource가 없으면 해당 게이지 자동 비활성화
  - [x] Mana == null이면 마나 게이지 비활성화
  - [x] Shield == null이면 보호막 게이지 비활성화

### Vital 게이지 시스템 개선
- [x] Vital.Field에 PlayerGauge 프로퍼티 추가
- [x] Vital.Gauge에 SpawnCharacterGauge() 메서드 추가
  - [x] Owner.IsPlayer에 따라 플레이어/몬스터 게이지 분기 생성
  - [x] SpawnPlayerGauge() private 메서드 추가
  - [x] SpawnEnemyGauge() private 메서드로 변경
- [x] Refresh 메서드들 수정
  - [x] RefreshHealthGauge(): EnemyGauge 또는 PlayerGauge 중 존재하는 게이지 사용
  - [x] RefreshResourceGauge(): PlayerGauge만 사용 (마나)
  - [x] RefreshShieldGauge(): PlayerGauge만 사용 (보호막)
- [x] ResourcesManager에 SpawnPlayerGauge() 메서드 추가

### Vital 네이밍 정리
- [x] Life → Health로 리네이밍
  - [x] Vital.Field: Life → Health
  - [x] Vital.cs: Life 참조 → Health 참조
  - [x] Vital.Gauge: RefreshLifeGauge() → RefreshHealthGauge()
  - [x] Vital.Gauge: ConsumeLifePotion() → ConsumeHealthPotion()
  - [x] VitalConsumeTypes: FixedLife → FixedHealth
  - [x] VitalConsumeTypes: MaxLifePercent → MaxHealthPercent
  - [x] VitalConsumeTypes: CurrentLifePercent → CurrentHealthPercent
  - [x] Life.cs → Health.cs 파일 리네이밍

